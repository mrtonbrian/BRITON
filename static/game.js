var board,squareToHighlight,boardEl=$("#board"),game=new Chess,evals=[],count=1,moves=0,removeGreySquares=function(){$("#board .square-55d63").css("background","")},greySquare=function(e){var o=$("#board .square-"+e),a="#a9a9a9";!0===o.hasClass("black-3c85d")&&(a="#696969"),o.css("background",a)},removeHighlights=function(e){boardEl.find(".square-55d63").removeClass("highlight-"+e)},onDragStart=function(e,o,a,n){if(!0===game.in_checkmate()||!0===game.in_draw())return!1},onMouseoverSquare=function(e,o){var a=game.moves({square:e,verbose:!0});if(0!==a.length){greySquare(e);for(var n=0;n<a.length;n++)greySquare(a[n].to)}},onMouseoutSquare=function(e,o){removeGreySquares()},onDrop=function(e,o){if(null===game.move({from:e,to:o,promotion:"q"}))return"snapback";moves++,boardEl.find(".square-"+e).addClass("highlight-white"),boardEl.find(".square-"+o).addClass("highlight-white");var a=JSON.stringify({time:parseFloat(document.getElementById("seconds").value),pgn:game.pgn()});board.draggable=!1,$.post("/move",a,function(e,o){game.move(e.move,{sloppy:!0}),console.log("EVAL: "+e.eval),evals.push(e.eval),removeHighlights("white"),removeHighlights("black"),boardEl.find(".square-"+e.from).addClass("highlight-black"),boardEl.find(".square-"+e.to).addClass("highlight-black"),board.position(game.fen()),moves++,document.getElementById("eval").innerHTML=e.eval,board.draggable=!0})},resetBoard=function(){document.getElementById("reset").innerHTML="",game.reset(),board.position(game.fen());chooseSide()},onMoveEnd=function(){if(console.log("MOVEEND"),boardEl.find(".square-"+squareToHighlight).addClass("highlight-black"),removeGreySquares(),game.in_checkmate()?alert("YOU HATH BEEN MATED"):game.in_draw()&&alert("There is a draw :|"),game.game_over()){var e=document.createElement("input");e.type="button",e.value="Reset!",e.onclick=resetBoard,document.getElementById("reset").appendChild(e)}},onSnapEnd=function(){board.position(game.fen())},cfg={draggable:!0,position:"start",onDragStart:onDragStart,onDrop:onDrop,onMoveEnd:onMoveEnd,onSnapEnd:onSnapEnd,onMouseoutSquare:onMouseoutSquare,onMouseoverSquare:onMouseoverSquare},getPlayerTurn=function(){return count-1==1?"w":"b"},undo=function(){if(count>0){removeHighlights(),game.turn()===getPlayerTurn()?(game.undo(),game.undo(),evals.pop()):game.undo(),board.position(game.fen());var e=evals.pop();document.getElementById("eval").innerHTML=null!=e?e:"0",moves--}},bestMove=function(){if(!game.game_over()){var e=JSON.stringify({time:parseFloat(document.getElementById("seconds").value),pgn:game.pgn()});board.draggable=!1,$.post("/move",e,function(e,o){if(game.move(e.move,{sloppy:!0}),console.log("EVAL: "+e.eval),document.getElementById("eval").innerHTML=e.eval,removeHighlights("white"),removeHighlights("black"),boardEl.find(".square-"+e.from).addClass("highlight-white"),boardEl.find(".square-"+e.to).addClass("highlight-white"),board.position(game.fen()),!game.game_over()){var a=JSON.stringify({time:parseFloat(document.getElementById("seconds").value),pgn:game.pgn()});$.post("/move",a,function(e,o){game.move(e.move,{sloppy:!0}),console.log("EVAL: "+e.eval),document.getElementById("eval").innerHTML=e.eval,removeHighlights("white"),removeHighlights("black"),boardEl.find(".square-"+e.from).addClass("highlight-black"),boardEl.find(".square-"+e.to).addClass("highlight-black"),board.position(game.fen()),board.draggable=!0})}})}};function setVal(){document.getElementById("seconds").value="0.5",document.getElementById("tb").onclick=undo,document.getElementById("bm").onclick=bestMove}window.onload=setVal(),board=ChessBoard("board",cfg);var chooseSide=function(){if(count%2==1)board.orientation("white");else{board.orientation("black");var e=JSON.stringify({time:parseFloat(document.getElementById("seconds").value),pgn:game.pgn()});board.draggable=!1,$.post("/move",e,function(e,o){game.move(e.move,{sloppy:!0}),console.log("EVAL: "+e.eval),removeHighlights("white"),removeHighlights("black"),boardEl.find(".square-"+e.from).addClass("highlight-black"),boardEl.find(".square-"+e.to).addClass("highlight-black"),board.position(game.fen()),board.draggable=!0})}count++},stuff=chooseSide();